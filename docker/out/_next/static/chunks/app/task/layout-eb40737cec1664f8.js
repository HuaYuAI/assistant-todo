(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{54023:function(e,t,a){Promise.resolve().then(a.bind(a,17577))},16463:function(e,t,a){"use strict";var r=a(71169);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},67098:function(e,t,a){"use strict";a.d(t,{GD:function(){return l},Lu:function(){return m},Lx:function(){return d},_5:function(){return p},_X:function(){return s},g:function(){return h},gI:function(){return c},xJ:function(){return u},yU:function(){return o}});var r,o,n=a(19088),i=a(42126);async function l(e){(0,n.unstable_noStore)();try{return(await i.Z.get("http://taskmanagerserver.com:8090/search/task_message_tree?search="+encodeURIComponent(e))).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function d(e){(0,n.unstable_noStore)();try{return(await i.Z.put("http://taskmanagerserver.com:8090/search/task_message_tree",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function s(e){(0,n.unstable_noStore)();try{return(await i.Z.get("http://taskmanagerserver.com:8090/task/"+e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function c(e){(0,n.unstable_noStore)();try{return(await i.Z.post("http://taskmanagerserver.com:8090/task",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function u(e){(0,n.unstable_noStore)();try{return(await i.Z.put("http://taskmanagerserver.com:8090/task",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function p(e){(0,n.unstable_noStore)();try{return(await i.Z.delete("http://taskmanagerserver.com:8090/task/"+e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}let m=[{id:3,code:"3",name:"重要紧急",order:0,color:"red"},{id:2,code:"2",name:"重要不紧急",order:1,color:"yellow"},{id:1,code:"1",name:"不重要紧急",order:2,color:"#fafafa"},{id:0,code:"0",name:"不重要不紧急",order:3,color:"green"}],h=[{id:7,code:"7",name:"完成",order:7,color:"GREEN"},{id:8,code:"8",name:"新建",order:8,color:"RED"},{id:9,code:"9",name:"进行中",order:9,color:"YELLOW"}];(r=o||(o={}))[r.DETAIL=0]="DETAIL",r[r.ADD_CHILD=1]="ADD_CHILD",r[r.UPDATE=2]="UPDATE",r[r.DELETE=3]="DELETE",r[r.COMPLETE=4]="COMPLETE",r[r.SHOW_FOUR=5]="SHOW_FOUR",r[r.ADD=6]="ADD"},17577:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(57437),o=a(2265),n=a(41306),i=a(23288),l=a(46682),d=a(17460),s=a(16463),c=a(1653),u=a(67098);a(8822);var p=a(91150),m=a(62737),h=a.n(m);let f=e=>{let{setTaskState:t,setExpectedStartTime:a,refreshData:m}=e,{replace:f}=(0,s.useRouter)();console.log("usePathname()",(0,s.usePathname)());let g=(0,o.useContext)(p.Z),{RangePicker:v}=n.default,y=g.expectedStartTime.length>0?JSON.parse(g.expectedStartTime):[void 0,void 0];y.map(e=>e&&e.value?h()(e.value.toString()):void 0);let x=[y[0]&&y[0].value?h()(y[0].value.toString()):void 0,y[1]&&y[1].value?h()(y[1].value.toString()):void 0];return(0,r.jsxs)(i.Z,{style:{marginTop:0,height:"42px",alignContent:"center"},children:[(0,r.jsx)(c.Q,{operationId:u.yU.ADD,description:"添加主线任务",reloadData:m}),(0,s.usePathname)().startsWith("/task/project")?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.ZP,{type:"primary",onClick:()=>{f("/task/four")},children:"四象限显示"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.ZP,{type:"primary",onClick:()=>{f("/task/project")},children:"任务树"}),(0,r.jsx)("span",{style:{whiteSpace:"nowrap"},children:"任务状态:"}),(0,r.jsx)(d.Z,{mode:"multiple",allowClear:!0,style:{minWidth:"100px"},placeholder:"任务状态",defaultValue:g.taskState.split(","),onChange:e=>{console.log("onChange"),t(e.join(","))},options:u.g.map(e=>({label:e.name,value:e.code}))}),(0,r.jsx)("span",{style:{whiteSpace:"nowrap"},children:"期望开始时间范围:"}),(0,r.jsx)(v,{placeholder:["开始时间","结束时间"],defaultValue:x,allowEmpty:[!0,!0],onChange:(e,t)=>{if(console.log("onChange:",e,t),!e){a("");return}let r=[];e[0]?r.push({name:"expectedStartTime",value:e[0],operateType:">="}):r.push(void 0),e[1]?r.push({name:"expectedStartTime",value:e[1].add(1,"day"),operateType:"<"}):r.push(void 0),a(JSON.stringify(r))}})]})]})};var g=a(62586);function v(e){let{children:t}=e,[a,n]=o.useState("8,9"),i=[];i.push({name:"expectedStartTime",value:h()().subtract(7,"day"),operateType:">="}),i.push({name:"expectedStartTime",value:h()().add(7,"day"),operateType:"<"});let[l,d]=o.useState(JSON.stringify(i)),[s,c]=o.useState(!0);return console.log("taskState,expectedStartTime,refreshDataFlag",a,l,s),(0,r.jsx)(o.Fragment,{children:(0,r.jsx)(g.ZP,{theme:{components:{Table:{rowHoverBg:"#4096ff"}}},children:(0,r.jsxs)(p.Z.Provider,{value:{taskState:a,expectedStartTime:l,refreshData:s},children:[(0,r.jsx)(f,{setTaskState:n,setExpectedStartTime:d,refreshData:function(){c(!s)}}),t]})})})}},91150:function(e,t,a){"use strict";let r=a(2265).createContext({taskState:"",expectedStartTime:"",refreshData:!0});t.Z=r},1653:function(e,t,a){"use strict";a.d(t,{Q:function(){return x}});var r=a(57437),o=a(56115),n=a(26218),i=a(51031),l=a(12415),d=a(31024),s=a(8384),c=a(44951),u=a(32696),p=a(80809),m=a(46682),h=a(58569),f=a(2265),g=a(67098),v=a(62737),y=a.n(v);let x=e=>{let[t]=p.Z.useForm(),[a,v]=(0,f.useState)(0);return(0,r.jsxs)(n.Y,{title:e.operationId===g.yU.DETAIL?"任务详情":e.operationId===g.yU.ADD?"添加任务":e.operationId===g.yU.ADD?"修改任务":"",trigger:(0,r.jsxs)(m.ZP,{type:"primary",children:[(0,r.jsx)(o.Z,{}),e.description]}),form:t,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:()=>console.log("run")},onFinish:async t=>{console.log("Received values of form: ",t),void 0===t.pid&&(t.pid=0),(null===(r=t.expectedTimeRange)||void 0===r?void 0:r[0])!=void 0&&(t.expectedStartTime=y()(t.expectedTimeRange[0]).toDate()),(null===(o=t.expectedTimeRange)||void 0===o?void 0:o[1])!=void 0&&(t.expectedEndTime=y()(t.expectedTimeRange[1]).toDate()),(null===(n=t.actualTimeRange)||void 0===n?void 0:n[0])!=void 0&&(t.actualStartTime=y()(t.actualTimeRange[0]).toDate()),(null===(i=t.actualTimeRange)||void 0===i?void 0:i[1])!=void 0&&(t.actualEndTime=y()(t.actualTimeRange[1]).toDate()),t.pPid=a;var r,o,n,i,l=!1;return await (0,g.gI)(t).then(t=>{if(console.log("response",t),t.status.success){var a;h.ZP.success("添加任务成功："+t.data),console.log("props.reloadData?.()",e.reloadData),null===(a=e.reloadData)||void 0===a||a.call(e),l=!0}else h.ZP.error(t.status.message),l=!1}),l},children:[(0,r.jsx)(i.Z,{width:"sm",name:"id",hidden:!0,label:"主键"}),(0,r.jsx)(i.Z,{width:"sm",name:"code",hidden:!0,label:"任务编码"}),(0,r.jsx)(i.Z,{width:"sm",name:"pPid",initialValue:e.pPid,hidden:!0,label:"祖宗id"}),(0,r.jsxs)(l.A.Group,{children:[(0,r.jsx)(d.Z,{width:"md",request:()=>(0,g.GD)(JSON.stringify({pageSize:1e3,pageNumber:1,data:[{code:"pid",value:"0",operateType:"="},{code:"",value:!0,operateType:"TREE"}]})).then(e=>(function e(t){let a=[];return t.map(t=>{let r={label:t.name,value:t.id,pPid:t.pPid};t.children&&(r.children=e(t.children)),a.push(r)}),a})(e.data.content)),name:"pid",label:"父级任务",fieldProps:{onSelect:(e,t)=>{console.log("onSelect",e,t),v(t.pPid)}},disabled:e.operationId===g.yU.DETAIL}),(0,r.jsx)(i.Z,{width:"md",name:"name",label:"任务名称",tooltip:"最长为 24 位",placeholder:"请输入任务名称",disabled:e.operationId===g.yU.DETAIL})]}),(0,r.jsx)(s.Z,{name:"description",label:"任务描述",placeholder:"请输入任务描述",disabled:e.operationId===g.yU.DETAIL}),(0,r.jsxs)(l.A.Group,{children:[(0,r.jsx)(c.Z,{request:async()=>g.Lu.map(e=>({label:e.name,value:e.code})),width:"sm",name:"priority",label:"任务优先级",initialValue:"3",disabled:e.operationId===g.yU.DETAIL}),(0,r.jsx)(c.Z,{width:"sm",options:g.g.map(e=>({label:e.name,value:e.code})),name:"state",label:"任务状态",initialValue:"8",disabled:e.operationId===g.yU.DETAIL})]}),(0,r.jsxs)(l.A.Group,{children:[(0,r.jsx)(u.Z,{initialValue:[y()(),void 0],name:"expectedTimeRange",label:"期望时间",fieldProps:{allowEmpty:[!0,!0],showTime:!0,needConfirm:!1},placeholder:["开始时间","结束时间"],disabled:e.operationId===g.yU.DETAIL}),(0,r.jsx)(u.Z,{name:"actualTimeRange",label:"实际时间",fieldProps:{allowEmpty:[!0,!0],showTime:!0,needConfirm:!1},placeholder:["开始时间","结束时间"],disabled:e.operationId===g.yU.DETAIL})]})]})}},8822:function(){}},function(e){e.O(0,[979,167,746,971,23,744],function(){return e(e.s=54023)}),_N_E=e.O()}]);