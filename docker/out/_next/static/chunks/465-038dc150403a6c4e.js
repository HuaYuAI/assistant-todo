(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[465],{67098:function(e,t,a){"use strict";a.d(t,{GD:function(){return d},Lu:function(){return m},Lx:function(){return s},_5:function(){return p},_X:function(){return l},g:function(){return h},gI:function(){return c},xJ:function(){return u},yU:function(){return n}});var r,n,o=a(19088),i=a(42126);async function d(e){(0,o.unstable_noStore)();try{return(await i.Z.get("http://taskmanagerserver.com:8090/search/task_message_tree?search="+encodeURIComponent(e))).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function s(e){(0,o.unstable_noStore)();try{return(await i.Z.put("http://taskmanagerserver.com:8090/search/task_message_tree",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function l(e){(0,o.unstable_noStore)();try{return(await i.Z.get("http://taskmanagerserver.com:8090/task/"+e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function c(e){(0,o.unstable_noStore)();try{return(await i.Z.post("http://taskmanagerserver.com:8090/task",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function u(e){(0,o.unstable_noStore)();try{return(await i.Z.put("http://taskmanagerserver.com:8090/task",e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}async function p(e){(0,o.unstable_noStore)();try{return(await i.Z.delete("http://taskmanagerserver.com:8090/task/"+e)).data}catch(e){throw console.error("Error fetching data:",e),Error("Failed to fetch data")}}let m=[{id:3,code:"3",name:"重要紧急",order:0,color:"red"},{id:2,code:"2",name:"重要不紧急",order:1,color:"yellow"},{id:1,code:"1",name:"不重要紧急",order:2,color:"#fafafa"},{id:0,code:"0",name:"不重要不紧急",order:3,color:"green"}],h=[{id:7,code:"7",name:"完成",order:7,color:"GREEN"},{id:8,code:"8",name:"新建",order:8,color:"RED"},{id:9,code:"9",name:"进行中",order:9,color:"YELLOW"}];(r=n||(n={}))[r.DETAIL=0]="DETAIL",r[r.ADD_CHILD=1]="ADD_CHILD",r[r.UPDATE=2]="UPDATE",r[r.DELETE=3]="DELETE",r[r.COMPLETE=4]="COMPLETE",r[r.SHOW_FOUR=5]="SHOW_FOUR",r[r.ADD=6]="ADD"},42465:function(e,t,a){"use strict";a.d(t,{Z:function(){return j}});var r=a(57437),n=a(2265),o=a(62476),i=a(58569),d=a(32034),s=a(23288),l=a(61822),c=a(78288),u=a(24196);a(22054);var p=a(80809),m=a(41306),h=a(91867),f=a(17460),y=a(46682),x=a(62737),D=a.n(x),I=a(67098);let T=e=>{let[t]=p.Z.useForm(),[a]=(0,n.useState)(e.operationId===I.yU.DETAIL),{RangePicker:o}=m.default,{TextArea:d}=h.default;(0,n.useEffect)(()=>{if(e.operationId===I.yU.DETAIL||e.operationId===I.yU.UPDATE)(0,I._X)(e.itemId).then(a=>{if(console.log("getTask(props.itemId)",e.itemId,a),a.status.success){var r,n;a.data.state=null===(r=I.g.find(e=>{var t;return e.code===(null===(t=a.data.state)||void 0===t?void 0:t.toString())}))||void 0===r?void 0:r.name,a.data.priority=null===(n=I.Lu.find(e=>{var t;return e.code===(null===(t=a.data.priority)||void 0===t?void 0:t.toString())}))||void 0===n?void 0:n.name,a.data.priority,a.data.actualTimeRange=[a.data.actualStartTime?D()(a.data.actualStartTime):"",a.data.actualEndTime?D()(a.data.actualEndTime):""],a.data.expectedTimeRange=[a.data.expectedStartTime?D()(a.data.expectedStartTime):"",a.data.expectedEndTime?D()(a.data.expectedEndTime):""],t.setFieldsValue(a.data)}else i.ZP.error(a.status.message),e.handleCancel()});else if(e.operationId===I.yU.ADD||e.operationId===I.yU.ADD_CHILD){let e={expectedTimeRange:[D()(),void 0]};t.setFieldsValue(e)}},[]);let l=(e,t)=>{let a=[];for(let r=e;r<t;r++)a.push(r);return a},c=e=>(console.log("current",e,e&&e<D()().endOf("day"),e<D()().endOf("day")),e<D()().startOf("day")),u=(e,t)=>(console.log("current",e),"start"===t)?{disabledHours:()=>l(0,60).splice(4,20),disabledMinutes:()=>l(30,60),disabledSeconds:()=>[55,56]}:{disabledHours:()=>l(0,60).splice(20,4),disabledMinutes:()=>l(0,31),disabledSeconds:()=>[55,56]};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(p.Z,{labelCol:{span:4},wrapperCol:{span:18},layout:"horizontal",disabled:a,size:"large",onFinish:t=>{console.log(t);let a={key:t.id,id:t.id,pPid:e.operationId===I.yU.ADD_CHILD?e.pPid:t.pPid,pid:e.operationId===I.yU.ADD_CHILD?e.itemId:e.operationId===I.yU.UPDATE?t.pid:0,code:t.code,name:t.name,description:t.description,state:t.state,priority:t.priority,type:t.type,children:[]};if(t.expectedTimeRange&&(t.expectedTimeRange[0]&&(a.expectedStartTime=t.expectedTimeRange[0]),t.expectedTimeRange[1]&&(a.expectedEndTime=t.expectedTimeRange[1])),t.actualTimeRange&&(t.actualTimeRange[0]&&(a.actualStartTime=t.actualTimeRange[0]),t.actualTimeRange[1]&&(a.actualEndTime=t.actualTimeRange[1])),e.operationId===I.yU.ADD_CHILD)(0,I.gI)(a).then(t=>{console.log("response",t),t.status.success&&(i.ZP.success("添加任务成功："+t.data),e.handleCancel())});else if(e.operationId===I.yU.UPDATE){var r=I.g.find(e=>{var t;return e.name===(null===(t=a.state)||void 0===t?void 0:t.toString())});r&&(a.state=r.code);var n=I.Lu.find(e=>{var t;return e.name===(null===(t=a.priority)||void 0===t?void 0:t.toString())});n&&(a.priority=n.code),(0,I.xJ)(a).then(t=>{console.log("response",t),t.status.success?(i.ZP.success("修改任务成功："+t.data),e.handleCancel()):i.ZP.error(t.status.message)})}},form:t,children:[(0,r.jsx)(p.Z.Item,{name:"id",label:"id",hidden:!0,children:(0,r.jsx)(h.default,{name:"id"})}),(0,r.jsx)(p.Z.Item,{name:"pid",label:"pid",hidden:!0,children:(0,r.jsx)(h.default,{name:"pid"})}),(0,r.jsx)(p.Z.Item,{name:"code",label:"code",hidden:!0,children:(0,r.jsx)(h.default,{name:"code"})}),(0,r.jsx)(p.Z.Item,{name:"pPid",label:"pPid",hidden:!0,children:(0,r.jsx)(h.default,{name:"pPid"})}),(0,r.jsx)(p.Z.Item,{name:"name",label:"任务名称",rules:[{required:!0,message:"任务名称不能为空"}],children:(0,r.jsx)(h.default,{name:"name"})}),(0,r.jsx)(p.Z.Item,{name:"description",label:"任务描述",children:(0,r.jsx)(d,{name:"description",rows:4})}),(0,r.jsx)(p.Z.Item,{name:"priority",initialValue:"3",label:"任务优先级",children:(0,r.jsx)(f.Z,{allowClear:!0,options:I.Lu.map(e=>({label:e.name,value:e.code}))})}),(0,r.jsx)(p.Z.Item,{name:"state",initialValue:"8",label:"任务状态",children:(0,r.jsx)(f.Z,{allowClear:!0,options:I.g.map(e=>({label:e.name,value:e.code}))})}),(0,r.jsx)(p.Z.Item,{name:"expectedTimeRange",label:"期望",children:(0,r.jsx)(o,{disabledDate:c,disabledTime:u,placeholder:["开始时间","结束时间"],allowEmpty:[!0,!0],needConfirm:!1,showTime:{hideDisabledOptions:!0,defaultValue:[D()("00:00:00","HH:mm:ss"),D()("23:59:59","HH:mm:ss")]}})}),(0,r.jsx)(p.Z.Item,{name:"actualTimeRange",label:"实际",children:(0,r.jsx)(o,{disabledDate:c,disabledTime:u,placeholder:["开始时间","结束时间"],allowEmpty:[!0,!0],needConfirm:!1,showTime:{hideDisabledOptions:!0,defaultValue:[D()("00:00:00","HH:mm:ss"),D()("11:59:59","HH:mm:ss")]}})}),(0,r.jsx)(p.Z.Item,{children:(0,r.jsx)(s.Z,{children:e.operationId===I.yU.DETAIL?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.ZP,{type:"primary",htmlType:"submit",children:"确认"}),(0,r.jsx)(y.ZP,{htmlType:"button",children:"取消"})]})})})]})})};var g=a(87138);class E extends n.Component{render(){let e=()=>{if(this.setState({...this.state,openModal:!1}),this.state.operationId!==I.yU.DETAIL){var e,t;null===(e=(t=this.props).refreshDate)||void 0===e||e.call(t)}},t=[{key:I.yU.DETAIL,label:(0,r.jsx)("a",{onClick:e=>{this.setState({openModal:!0,operationId:I.yU.DETAIL})},children:"任务详情"})},{key:I.yU.ADD_CHILD,label:(0,r.jsx)("a",{onClick:e=>{this.setState({openModal:!0,operationId:I.yU.ADD_CHILD})},children:"添加支线任务"})},{key:I.yU.UPDATE,label:(0,r.jsx)("a",{onClick:e=>{this.setState({openModal:!0,operationId:I.yU.UPDATE})},children:"修改任务"})},{key:I.yU.DELETE,label:(0,r.jsx)(o.Z,{title:"删除任务",description:"确认要删除任务?",icon:(0,r.jsx)(c.Z,{style:{color:"red"}}),okText:"确认",cancelText:"取消",onConfirm:()=>{(0,I._5)(this.props.itemId).then(e=>{if(console.log("response",e),e.status.success){var t,a;i.ZP.success("删除任务成功："+e.data),null===(t=(a=this.props).refreshDate)||void 0===t||t.call(a)}})},children:(0,r.jsx)("a",{children:"删除任务"})})},{key:I.yU.COMPLETE,label:(0,r.jsx)(o.Z,{title:"完成任务",description:"确认要完成任务?",okText:"确认",cancelText:"取消",onConfirm:()=>{(0,I.Lx)({updateColoumList:[{name:"state",code:"state",value:"7"}],conditionColoumList:[{name:"id",code:"id",operateType:"=",value:this.props.itemId}]}).then(e=>{if(console.log("response",e),e.status.success){var t,a;i.ZP.success("完成任务成功"),null===(t=(a=this.props).refreshDate)||void 0===t||t.call(a)}})},children:(0,r.jsx)("a",{children:"完成任务"})})},{key:I.yU.SHOW_FOUR,label:(0,r.jsx)(g.default,{href:"/task/four?pid="+this.props.itemId,children:"四象限显示子任务"})}];return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(d.Z,{menu:{items:t,onClick:e=>{let{key:t}=e;console.log(t)}},children:(0,r.jsx)("a",{onClick:e=>{e.preventDefault()},children:(0,r.jsxs)(s.Z,{children:["操作",(0,r.jsx)(u.Z,{})]})})}),(0,r.jsx)(l.Z,{maskClosable:!1,destroyOnClose:!0,open:this.state.openModal,title:this.state.operationId===I.yU.DETAIL?"任务详情":this.state.operationId===I.yU.ADD_CHILD?"添加支线任务":this.state.operationId===I.yU.UPDATE?"修改任务":"未知操作",onCancel:e,footer:[],width:800,children:(0,r.jsx)(T,{itemId:this.props.itemId,operationId:this.state.operationId,handleCancel:e,pPid:this.props.pPid})})]})}constructor(e){super(e),this.state={pid:e.pid,pPid:e.pPid,operationId:void 0,openModal:!1}}}var j=E},22054:function(){}}]);